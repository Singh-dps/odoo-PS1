generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  username      String   @unique
  email         String   @unique
  password_hash String
  role          String   @default("staff") // manager, staff
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Product {
  id          String      @id @default(uuid())
  name        String
  sku         String      @unique
  barcode     String?
  category    String?
  cost        Float       @default(0)
  price       Float       @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  stockMoves  StockMove[]
}

model Warehouse {
  id        String     @id @default(uuid())
  name      String
  shortCode String     @unique
  locations Location[]
}

model Location {
  id           String      @id @default(uuid())
  name         String
  type         String      @default("internal") // internal, customer, supplier, loss
  warehouseId  String?
  warehouse    Warehouse?  @relation(fields: [warehouseId], references: [id])
  stockMovesSrc StockMove[] @relation("SourceLocation")
  stockMovesDest StockMove[] @relation("DestLocation")
}

model OperationType {
  id           String           @id @default(uuid())
  name         String
  type         String           // receipt, delivery, internal
  sequenceCode String           @unique
  operations   StockOperation[]
}

model StockOperation {
  id              String        @id @default(uuid())
  reference       String        @unique // e.g., WH/IN/0001
  operationTypeId String
  operationType   OperationType @relation(fields: [operationTypeId], references: [id])
  status          String        @default("draft") // draft, waiting, ready, done, canceled
  scheduledDate   DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  moves           StockMove[]
}

model StockMove {
  id             String         @id @default(uuid())
  operationId    String
  operation      StockOperation @relation(fields: [operationId], references: [id])
  productId      String
  product        Product        @relation(fields: [productId], references: [id])
  quantity       Float
  locationSrcId  String
  locationSrc    Location       @relation("SourceLocation", fields: [locationSrcId], references: [id])
  locationDestId String
  locationDest   Location       @relation("DestLocation", fields: [locationDestId], references: [id])
  status         String         @default("draft") // draft, done
  createdAt      DateTime       @default(now())
}
